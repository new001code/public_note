# Vim实用技巧

## 技巧1 `.`是一个微型的宏

`.` 会重复上次执行的修改(命令)

## 技巧2 不要自我重复

在很多时候，需要在行尾添加内容，就可以使用`.`来重复这个动作

```vim
var a = 123;
var b = "abc";
var c = "hello world";
```

第一行使用`A;`来给行尾添加`;`，然后`j.`就可以在下一行执行相同的动作。

减少重复移动，比如把`$a`替换为`A`即可

### 复合命令

| 复合命令 | 等效长命令                                  |
| :------- | ------------------------------------------- |
| C        | c$ //删空光标后的内容到行尾，并进入插入模式 |
| s        | cl //删除一个字符，并进入插入模式           |
| S        | ^C //删空改行，并进入插入模式               |
| I        | ^i，到行首进入插入模式                      |
| A        | $a，到行尾进入插入模式                      |
| o        | A\<CR> //在下方插入空行                     |
| O        | 在上方插入空行                              |

## 技巧3 以退为进

比如在一个字符的前后各加一个空格

```vim
var a = "method("+argument1+","+argument2+")"
```

知识点：
> f{字符} 在行内查找下一个指定的字符，使用 `;` 和 `,` 进行前进和退回。
>
> /{pattern}在文档内查找下一处匹配的项; 使用 `n` 和 `N` 进行前进和退回。
>
> `*` 表示向下查找光标处的单词。
>
> `#` 表示向上查找光标处的单词。
>
> `s` 命令删除光标处的字符，并进入插入模式。因此可以 `s` 后输入 `空格+空格` 后 `ESC` 后完成单次操作

```vim
var a = "method(" + argument1 + "," + argument2 + ")"
```

## 技巧4 执行、重复、回退

可重复的操作及如何回退
| 目的                     | 操作                  | 重复 | 回退 |
| :----------------------- | :-------------------- | :--- | :--- |
| 做出一个修改             | {edit}                | .    | u    |
| 在行内查找下一指定字符   | f{char}/t{char}       | ;    | ,    |
| 在行内查找上一指定字符   | F{char}/T{char}       | ;    | ,    |
| 在文档中查找下一处匹配项 | /{pattern}            | n    | N    |
| 在文档处查找上一处匹配项 | ?{pattern}            | n    | N    |
| 执行替换                 | :s/target/replacement | &    | u    |
| 执行一系列修改           | qx{change}q           | @x   | u    |

## 技巧5 查找并手动替换

```txt
hello, my name is Bob;
Bob is my student;
Bog is a boy;
Here is Bob's place;
```

使用上面的命令来将 Bob 替换为 Alex `:%s/Bob/Alex`

## 技巧6 认识 . 范式

使用 `.` 重复上次的修改; 只需按一次键就可以移动到下一个目标处

## 技巧7 停顿时请移开画笔

多使用普通模式

## 技巧8 把撤销单元切换为块

在 Vim 中，可以自己控制撤销的力度。从进入插入模式开始，直到返回到普通模式为止，在此期间输入或删除的所有字符都被当成一次修改。

## 技巧9 构造可重复的修改

类似 `daw`?

## 技巧10 用次数做简单的算术运算

`<C-a>`和`<C-x>`执行数字的加和减操作。

## 技巧11 能够重复，就别用次数

`d5w` or `dw....`

## 技巧12 双剑合璧，天下无敌

操作符 + 操作命令 = 操作

d{motion}命令可以对一个字符(dl)、一个完整单词(daw)或一整个段落(dap)进行操作

| 命令 | 用途                               |
| ---- | ---------------------------------- |
| c    | 修改                               |
| d    | 删除                               |
| y    | 复制到寄存器                       |
| g~   | 转换大小写                         |
| gu   | 转换为小写                         |
| gU   | 转换为大写                         |
| >    | 增加缩进                           |
| <    | 减少缩进                           |
| =    | 自动缩进                           |
| !    | 使用外部程序过滤{motion}所跨越的行 |

## 技巧13 在插入模式中即时更正错误

> 如果在插入模式时写错了，可以立即对它进行更正，除了使用退格键外，还可以使用插入模式中的一些其他命令。

在插入模式下，使用下面这些组合键。

| 按键操作 | 用途                       |
| -------- | -------------------------- |
| \<C-h>   | 删除前一个字符（同退格键） |
| \<C-u>   | 删除至行首                 |

## 技巧14 返回普通模式

`<ESC>`,`<C-[>`,`<C-o>`可以从插入模式返回到普通模式。

## 技巧15 不离开插入模式，粘贴寄存器中的文本

> 在插入模式中，可以使用\<C-r>{register} 命令方便的粘贴

## 技巧16 随时随地做运算

> 表达式寄存器允许我们做一些运算，并把运算结果直接插入到文档中。

可以使用`=`访问表达式寄存器。在插入模式中，输入`<C-r> =` 就可以访问这一寄存器。

```vim
6 chairs， each costing $35, total $
```

可以使用表达式寄存器直接运算。直接使用vim可以，使用vscode-vim似乎不可以
`<C-r>=6*35<CR>`

## 技巧17 使用字符编码插入非常用字符

也需要直接使用vim

比如键盘上很难打出¿，就在可以在插入模式使用`<C-v>u00bf`来插入这个字符。

## 技巧18 使用二合字母插入非常用字符

在插入模式下，使用`<C-k>{char}{char}`，比如可以使用`<C-k>?I`来打出¿

## 技巧19 用替换模式替换已有的文本

`R`

## 技巧20 深入理解可视模式

可视模式允许在选中的一个文本区域进行操作

## 技巧21 选中高亮区域

使用`v` 或 `V`进行高亮选取，使用`<C-v>`是面向列块的可是模式。

## 技巧22 重复执行面向行的可视模式

使用 `.`

## 技巧23 只要可能，尽可能使用操作符命令，而不是可视命令

```html
<a href="#">one</a>
<a href="#">TWO</a>
<a href="#">THREE</a>
```

将a标签中的one等转为大写。

在可视模式下，使用 `vitU`将标签内的字符转大写，然后执行`j.`后重复执行，但是执行到three时发现只大写了前三个字符。
这是因为使用可视命令，会记录上一个大写的字符个数，重复执行时只会转变对应个数的字符。

使用操作符命令`gUit`会记录这个模式，就不会有上面的那个问题。

## 技巧24 用面向列块的可视模式编辑表格数据

假设有一个纯文本表格

```txt
Chapter        | page
---------------------
Normal mode    | 15
Insert mode    | 31
Visual mode    | 44
```

我们想用`管道符|` 画一条竖线来隔开这两个文本，使之看起来更像一个表格。

> 使用 \<C-v> 进入列选择模式，然后 `3j` 选中到表格结尾一行的文本。然后，按`x`删除此列，使用`.`重复此操作。
>
> 删除到合适位置后，使用`gv`重选上次的高亮区域， 然后使用`r|`，使用`|`替换选区内的字符
>
> 到行首，`yyp` 复制粘贴行首内容。然后使用`Vr-`来将本行的所有字符都替换为-

## 技巧25 修改列文本

```css
a {background-image: url('/image/one.png')}
a {background-image: url('/image/two.png')}
a {background-image: url('/image/three.png')}
```

> 使用\<C-v>进入列选择模式，`j`选择所有的行，`e`选择image单词，`c`后替换。按esc后就可以全部替换了。

## 技巧26 在长短不一的高亮块后添加文本

```txt
var a = 1231;
var b = "hello world";
var c = "ads";
```

每一行的文本长度不一样，除了使用`A;`外，也可以使用列选择模式。`C-v2j$A;<ESC>`

## 技巧27 认识Vim的命令行模式

## 技巧28 在一行或多个连续行上执行命令

很多Ex命令可以使用`[range]`指定要操作的范围，可以使用行号，位置标记或是查找模式来指定范围的开始位置和结束位置。
`:{start}{end}`
定义范围的语法非常灵活，可以混用搭配`行号`、`位置标记`以及查找模式。

| 符号 | 地址                         |
| ---- | ---------------------------- |
| 1    | 文件的第一行                 |
| $    | 文件的最后一行               |
| 0    | 虚拟行，位于文件第一行的上方 |
| .    | 光标所在行                   |
| 'm   | 包含文本标记m的行            |
| '<   | 高亮选区的起始行             |
| '>   | 高亮选区的结束行             |
| %    | 整个文件                     |

## 技巧29 使用':t'和':m'命令复制和移动行

```txt
line1
line2
line3
```

## 技巧30 在指定范围上执行普通模式命令

> 如果想在一系列连续行上执行一条普通的命令，可以使用 `:normal` 命令。此命令在与 `.` 命令或宏宏结合使用时，就可以很容易地执行大量重复性工作。
